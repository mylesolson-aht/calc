<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membership Value Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem; /* Equivalent to gap-6 */
        }
        .membership-card {
            background-color: #fff;
            border: 2px solid transparent;
            padding: 1.5rem; /* p-6 */
            border-radius: 1.5rem; /* rounded-2xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-lg */
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            width: 100%;
            max-width: 24rem; /* For responsiveness on smaller screens */
        }
        .membership-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* hover:shadow-xl */
            transform: translateY(-5px);
        }
        .membership-card.selected {
            border-color: #0d9488; /* A darker shade of teal for emphasis */
            box-shadow: 0 0 0 4px #99f6e4, 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-5px);
        }
        .label-best-value {
            background: linear-gradient(145deg, #fef08a, #fcd34d);
            color: #b45309;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px; /* rounded-full */
        }
        .label-trial {
            background: linear-gradient(145deg, #ffedd5, #fdba74);
            color: #c2410c;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px; /* rounded-full */
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 md:p-10 rounded-3xl shadow-2xl max-w-4xl w-full">
        <!-- Brand Logo -->
        <img src="https://static.wixstatic.com/media/adc95e_3a3ff74aa44a4ae4840737c3b941f67d~mv2.png/v1/crop/x_0,y_296,w_1129,h_607/fill/w_212,h_114,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Aloha-Hawaii-Tours%26Travel_LOGO2.png" alt="Aloha Hawaii Tours & Travel Logo" class="mx-auto mb-6 w-48 h-auto">
        <h1 class="text-4xl md:text-5xl font-bold text-center text-gray-800 mb-2">Find Your Perfect Membership</h1>
        <p class="text-center text-gray-500 mb-8">Select your membership and special offers to see the total value.</p>

        <!-- Podium Speaker Name Input -->
        <div class="mb-4">
            <label for="podium-speaker-name" class="block text-gray-700 font-medium mb-2">Podium Speaker Name</label>
            <input type="text" id="podium-speaker-name" placeholder="Enter speaker's name" class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500">
        </div>

        <!-- Guest Name Input -->
        <div class="mb-8">
            <label for="guest-name" class="block text-gray-700 font-medium mb-2">Guest Name</label>
            <input type="text" id="guest-name" placeholder="Enter guest's name" class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500">
        </div>
        
        <!-- Membership Selection -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Choose Your Membership</h2>
            <div id="membership-cards" class="card-container">
                <!-- Legacy Membership -->
                <div id="legacy-card" class="membership-card">
                    <h3 class="text-xl font-bold text-teal-600">Legacy Membership</h3>
                    <p class="text-sm font-semibold text-gray-500 mb-4">The ultimate value, unlock your best memories.</p>
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <span class="text-sm text-gray-400 line-through">$7,999 Retail</span>
                            <span class="text-2xl font-bold text-gray-800 block">$4,499</span>
                        </div>
                        <span class="label-best-value">Best Value</span>
                    </div>
                    <ul class="text-gray-600 text-sm space-y-2">
                        <li>Lifetime Access. Willable & Transferable.</li>
                        <li>Experience luxury destinations at wholesale rates, forever.</li>
                        <li>Access to direct, raw-rate pricing on all travel.</li>
                    </ul>
                </div>
                <!-- 10 Membership -->
                <div id="ten-card" class="membership-card">
                    <h3 class="text-xl font-bold text-cyan-600">10-Year Membership</h3>
                    <p class="text-sm font-semibold text-gray-500 mb-4">Same unlimited access, at a more affordable price.</p>
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <span class="text-sm text-gray-400 line-through">$5,999 Retail</span>
                            <span class="text-2xl font-bold text-gray-800 block">$2,499</span>
                        </div>
                    </div>
                    <ul class="text-gray-600 text-sm space-y-2">
                        <li>Unlimited Access.</li>
                        <li>Everyday savings on top-quality brand-name vacations, hotels, cruises and rental cars.</li>
                    </ul>
                </div>
                <!-- Hidden 3 Membership -->
                <div id="three-card" class="membership-card hidden">
                    <h3 class="text-xl font-bold text-amber-600">3-Year Membership</h3>
                    <p class="text-sm font-semibold text-gray-500 mb-4">Take it for a Test Drive. Unlimited Access.</p>
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <span class="text-sm text-gray-400 block mb-1">Not Available Retail</span>
                            <span class="text-2xl font-bold text-gray-800">$999</span>
                        </div>
                        <span class="label-trial">Trial</span>
                    </div>
                    <ul class="text-gray-600 text-sm space-y-2">
                        <li>Save money and time on hotels, rental cars, and cruises.</li>
                    </ul>
                </div>
            </div>
            <!-- Upgrade Offer Button -->
            <div class="hidden mt-4 text-center" id="upgrade-offer-container">
                <button id="upgrade-offer-btn" class="w-full md:w-auto p-4 rounded-xl bg-teal-50 text-teal-700 font-semibold transition-all duration-300 hover:bg-teal-100 focus:outline-none focus:ring-2 focus:ring-teal-500">
                </button>
            </div>

            <!-- Last Ditch Pitch Button -->
            <div class="text-center mt-6">
                <button id="show-three-btn" class="text-sm text-gray-500 underline transition-all duration-300 hover:text-gray-700">Memberships Declined</button>
            </div>
        </div>

        <!-- PREMIUM GIFTS SECTION -->
        <div class="mt-6 bg-gray-50 p-6 rounded-2xl shadow-inner border border-gray-200">
            <h3 class="text-xl font-semibold text-gray-700 mb-2">Premium Gifts</h3>
            <p class="text-sm italic text-gray-500 mb-4">Webinar Exclusive Offerings</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Global Week Stay Offer -->
                <label class="flex items-center space-x-3 bg-gray-50 p-4 rounded-xl cursor-pointer shadow transition-all duration-300 hover:shadow-md">
                    <input type="checkbox" id="global-week-offer" name="ta-offer" value="2000" class="form-checkbox text-teal-600 h-5 w-5 rounded">
                    <span class="text-gray-700 font-medium">Global Week Stay Certificate ($2,000 value)</span>
                </label>
                <!-- Hawaii Certificate Offer -->
                <label class="flex items-center space-x-3 bg-gray-50 p-4 rounded-xl cursor-pointer shadow transition-all duration-300 hover:shadow-md">
                    <input type="checkbox" id="hawaii-offer" name="ta-offer" value="1000" class="form-checkbox text-teal-600 h-5 w-5 rounded">
                    <span class="text-gray-700 font-medium">Hawaii Certificate ($1,000 value)</span>
                </label>
            </div>
        </div>

        <!-- Financing and Summary Section -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Financing Details</h2>
            <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                 <!-- Financing Terms -->
                 <div class="mb-4">
                    <label for="financing-term" class="block text-gray-700 font-medium mb-2">Financing Term</label>
                    <select id="financing-term" class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500">
                        <option value="6">6 Months</option>
                        <option value="12">12 Months</option>
                        <option value="18">18 Months</option>
                        <option value="24" selected>24 Months</option>
                    </select>
                </div>
                 <!-- Downpayment Input -->
                <div class="mb-4">
                    <label for="downpayment" class="block text-gray-700 font-medium mb-2">Downpayment</label>
                    <input type="number" id="downpayment" placeholder="Enter amount" min="0" value="0" step="50" class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500">
                </div>
                <!-- Monthly Payment Display -->
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-700 font-medium">Monthly Payment:</span>
                    <span id="monthly-payment" class="font-bold text-gray-800 text-xl">$0.00</span>
                </div>
            </div>
        </div>

        <!-- Summary & Results -->
        <div class="bg-gray-100 p-6 rounded-2xl">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Package Summary</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                <div class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">Membership Cost:</span>
                    <span id="membership-cost" class="font-bold text-gray-800">$0.00</span>
                </div>
                <div class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">First Year Annual Fee:</span>
                    <span id="annual-fee" class="font-bold text-gray-800">$0.00</span>
                </div>
                <div class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">Total Gift Value:</span>
                    <span id="gift-value" class="font-bold text-green-600">$0.00</span>
                </div>
                <!-- New line for Cash Out discount -->
                <div class="flex justify-between items-center border-b pb-2" id="cash-out-line">
                    <span class="font-medium">Cash Discount:</span>
                    <span id="cash-out-discount" class="font-bold text-red-600">$0.00</span>
                </div>
                <div class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">Total Discounts:</span>
                    <span id="total-discounts" class="font-bold text-red-600">$0.00</span>
                </div>
                <div class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">Financing Cost:</span>
                    <span id="financing-cost" class="font-bold text-red-600">$0.00</span>
                </div>
                <div class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">Downpayment:</span>
                    <span id="downpayment-value" class="font-bold text-gray-800">$0.00</span>
                </div>
                 <!-- Correctly added total cost display -->
                <div class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">Total Cost:</span>
                    <span id="total-cost" class="font-bold text-gray-800">$0.00</span>
                </div>
                <div class="flex justify-between items-center border-b pb-2 md:col-span-2">
                    <span class="font-medium">Interest Savings:</span>
                    <span id="interest-savings" class="font-bold text-green-600 text-lg md:text-xl"></span>
                </div>
                <div class="flex justify-between items-center border-b pb-2 md:col-span-2">
                    <span class="font-medium">Total Package Value:</span>
                    <span id="package-value" class="font-bold text-green-600 text-xl md:text-2xl">$0.00</span>
                </div>
                <div class="flex justify-between items-center border-b pb-2 md:col-span-2">
                    <span class="font-medium">Net Savings:</span>
                    <span id="net-savings" class="font-bold text-teal-600 text-xl md:text-2xl">$0.00</span>
                </div>
            </div>
            <p id="disclaimer" class="text-center text-sm italic mt-4 text-gray-500">
                This is for illustration purposes only and does not constitute a formal quote. All figures are estimates.
            </p>
        </div>

        <!-- Final Membership CTA Section -->
        <div id="payment-cta-container" class="mt-8 bg-teal-50 p-6 rounded-2xl text-center shadow-lg">
            <h3 class="text-2xl font-bold text-teal-800 mb-2">Your Travel Program</h3>
            <p class="text-4xl font-extrabold text-teal-600 mb-6" id="final-price-display">$0.00</p>
            <button id="payment-page-btn" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-teal-500">
                Go to Payment Page
            </button>
            <div id="vlo-message" class="mt-4 text-center text-gray-700 font-semibold hidden"></div>
        </div>

        <!-- ADVANCED OPTIONS SECTION -->
        <div id="advanced-options-container" class="mt-6 bg-gray-50 p-6 rounded-2xl shadow-inner border border-gray-200">
            <div id="advanced-options-header" class="flex justify-between items-center cursor-pointer">
                <h3 class="text-xl font-semibold text-gray-700">Advanced Options</h3>
                <button id="toggle-options-btn" class="text-gray-500 hover:text-gray-700">
                    <svg id="eye-open" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                    </svg>
                    <svg id="eye-closed" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-14-14zm-1.414 7.07a1 1 0 00-.707 1.414l1.414 1.414a1 1 0 001.414-.707l-1.414-1.414zM10 17a1 1 0 001.414-1.414L10 14.586l-1.414 1.414a1 1 0 001.414 1.414z" clip-rule="evenodd"/>
                        <path d="M16.912 12.232l-2.253 2.253a4 4 0 01-5.656-5.656L9.088 6.232A4 4 0 0116.912 12.232z"/>
                    </svg>
                </button>
            </div>
            <!-- The following div is what will be hidden/shown -->
            <div id="advanced-options-content" class="mt-4 hidden">
                <p class="text-sm italic text-gray-500 mb-4 font-semibold">Note: These options require manager approval.</p>
                <!-- Waive Annual Fee -->
                <label class="flex items-center space-x-3 cursor-pointer mb-4">
                    <input type="checkbox" id="annual-fee-waived" class="form-checkbox text-teal-600 h-5 w-5 rounded">
                    <span class="text-gray-700 font-medium">Waive First Year Annual Fee ($199)</span>
                </label>
                <!-- Webinar Exclusive Offerings -->
                <div class="mb-4">
                    <p class="font-semibold text-gray-700">Webinar Exclusive Offerings</p>
                    <div id="webinar-exclusive-options" class="mt-2 pl-8 space-y-2 text-sm text-gray-600">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" name="discount-option" value="250" class="discount-radio form-radio text-teal-600 h-4 w-4">
                            <span class="ml-2">$250</span>
                        </label>
                        <label class="inline-flex items-center cursor-pointer ml-4">
                            <input type="radio" name="discount-option" value="500" class="discount-radio form-radio text-teal-600 h-4 w-4">
                            <span class="ml-2">$500</span>
                        </label>
                        <label class="flex items-center cursor-pointer mt-4">
                            <input type="radio" name="discount-option" value="cash-discount" class="discount-radio form-radio text-teal-600 h-4 w-4">
                            <span class="ml-2">Cash Discount</span>
                            <input type="number" id="cash-out-input" placeholder="0" min="0" value="0" step="5" class="ml-4 p-2 rounded-xl border border-gray-300 w-24 focus:outline-none focus:ring-2 focus:ring-teal-500" disabled>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Constant values for membership data and calculations
            const MEMBERSHIPS = {
                legacy: { cost: 4499, retailCost: 7999, annualFee: 199, value: 3000 },
                ten: { cost: 2499, retailCost: 5999, annualFee: 199, value: 2000 },
                three: { cost: 999, retailCost: null, annualFee: 0, value: 0 }
            };
            const FINANCING_RATE = 17.99;
            const DOWNPAYMENT_MIN_PERCENT = 0.10;
            const DOWNPAYMENT_MAX_PERCENT = 1.00;
            const DOWNPAYMENT_DEFAULT_PERCENT = 0.20;

            // DOM element references
            const elements = {
                legacyCard: document.getElementById('legacy-card'),
                tenCard: document.getElementById('ten-card'),
                threeCard: document.getElementById('three-card'),
                showThreeBtn: document.getElementById('show-three-btn'),
                financingTermSelect: document.getElementById('financing-term'),
                downpaymentInput: document.getElementById('downpayment'),
                offers: document.querySelectorAll('input[name="ta-offer"]'),
                advancedOptionsHeader: document.getElementById('advanced-options-header'),
                advancedOptionsContent: document.getElementById('advanced-options-content'),
                eyeOpenIcon: document.getElementById('eye-open'),
                eyeClosedIcon: document.getElementById('eye-closed'),
                discountRadios: document.querySelectorAll('.discount-radio'),
                annualFeeWaivedCheckbox: document.getElementById('annual-fee-waived'),
                cashOutInput: document.getElementById('cash-out-input'),
                paymentPageBtn: document.getElementById('payment-page-btn'),
                vloMessageDiv: document.getElementById('vlo-message'),
                guestNameInput: document.getElementById('guest-name'),
                podiumSpeakerNameInput: document.getElementById('podium-speaker-name'),
                upgradeOfferContainer: document.getElementById('upgrade-offer-container'),
                upgradeOfferBtn: document.getElementById('upgrade-offer-btn'),
                membershipCostEl: document.getElementById('membership-cost'),
                annualFeeEl: document.getElementById('annual-fee'),
                giftValueEl: document.getElementById('gift-value'),
                financingCostEl: document.getElementById('financing-cost'),
                totalCostEl: document.getElementById('total-cost'),
                totalDiscountsEl: document.getElementById('total-discounts'),
                packageValueEl: document.getElementById('package-value'),
                netSavingsEl: document.getElementById('net-savings'),
                monthlyPaymentEl: document.getElementById('monthly-payment'),
                downpaymentValueEl: document.getElementById('downpayment-value'),
                interestSavingsEl: document.getElementById('interest-savings'),
                cashOutDiscountEl: document.getElementById('cash-out-discount'),
                cashOutLine: document.getElementById('cash-out-line'),
                finalPriceDisplay: document.getElementById('final-price-display'),
            };

            // Global state
            let selectedMembership = null;

            // --- Core Calculation Logic ---

            /**
             * Calculates all totals and updates the UI.
             */
            function calculateTotals() {
                if (!selectedMembership) {
                    renderResults({}); // Clear all displayed values
                    return;
                }

                // Get base membership data
                let { cost, annualFee, retailCost } = MEMBERSHIPS[selectedMembership];
                let downpayment = parseFloat(elements.downpaymentInput.value) || 0;

                // Calculate discounts first
                const { buybackDiscount, cashDiscount, totalDiscounts, finalCostAfterDiscounts } = getDiscounts(cost);

                // Re-clamp the downpayment amount based on the final cost after discounts
                const minDownpayment = finalCostAfterDiscounts * DOWNPAYMENT_MIN_PERCENT;
                const maxDownpayment = finalCostAfterDiscounts * DOWNPAYMENT_MAX_PERCENT;
                downpayment = Math.max(minDownpayment, Math.min(downpayment, maxDownpayment));
                
                // Update the downpayment input field to reflect the clamped value
                elements.downpaymentInput.value = Math.round(downpayment);

                // Handle annual fee waiver
                if (elements.annualFeeWaivedCheckbox.checked) {
                    annualFee = 0;
                }

                // Calculate financing details
                const { monthlyPayment, financingCost, interestSavings } = calculateFinancing(finalCostAfterDiscounts, downpayment);

                // Calculate gift value
                const giftValue = getGiftValue();
                
                // Calculate final summary values
                const totalCost = downpayment + (monthlyPayment * parseInt(elements.financingTermSelect.value, 10)) + annualFee;
                const totalPackageValue = (retailCost !== null ? retailCost : cost) + giftValue + (interestSavings > 0 ? interestSavings : 0);
                const netSavings = totalPackageValue - totalCost;

                renderResults({
                    membershipCost: cost,
                    annualFee,
                    giftValue,
                    totalDiscounts,
                    financingCost,
                    downpayment,
                    totalCost,
                    interestSavings,
                    packageValue: totalPackageValue,
                    netSavings,
                    monthlyPayment,
                    cashDiscount
                });
            }
            
            /**
             * Calculates the daily cost delta for upgrading to a new membership.
             * @param {string} currentMembership - The key for the current membership.
             * @param {string} targetMembership - The key for the target membership.
             * @returns {string} The formatted daily cost delta.
             */
            function calculateDailyUpgradeCost(currentMembership, targetMembership) {
                const currentCost = MEMBERSHIPS[currentMembership].cost;
                const targetCost = MEMBERSHIPS[targetMembership].cost;

                // Calculate down payments based on the default percentage
                const currentDownpayment = currentCost * DOWNPAYMENT_DEFAULT_PERCENT;
                const targetDownpayment = targetCost * DOWNPAYMENT_DEFAULT_PERCENT;

                // Calculate the financed amount for both memberships
                const currentFinanced = currentCost - currentDownpayment;
                const targetFinanced = targetCost - targetDownpayment;

                const financedDelta = targetFinanced - currentFinanced;

                const selectedTermInMonths = parseInt(elements.financingTermSelect.value, 10);
                const totalDays = selectedTermInMonths * 30.44; // Approx days per month
                
                const dailyCost = financedDelta / totalDays;
                
                return dailyCost.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }

            /**
             * Calculates the total value of selected gifts.
             * @returns {number}
             */
            function getGiftValue() {
                let giftValue = 0;
                elements.offers.forEach(offer => {
                    if (offer.checked) {
                        giftValue += parseFloat(offer.value);
                    }
                });
                return giftValue;
            }

            /**
             * Calculates all applicable discounts based on input state, enforcing the mutual exclusivity.
             * @param {number} membershipCost
             * @returns {{buybackDiscount: number, cashDiscount: number, totalDiscounts: number, finalCostAfterDiscounts: number}}
             */
            function getDiscounts(membershipCost) {
                let buybackDiscount = 0;
                let cashDiscount = 0;
                let maxCashDiscount = 0;

                const selectedDiscountRadio = document.querySelector('.discount-radio:checked');
                
                if (selectedDiscountRadio) {
                    const discountValue = selectedDiscountRadio.value;
                    if (discountValue === 'cash-discount') {
                        // Use the specific max cash discount values
                        if (selectedMembership === 'legacy') {
                            maxCashDiscount = 450;
                        } else if (selectedMembership === 'ten') {
                            maxCashDiscount = 250;
                        } else if (selectedMembership === 'three') {
                            maxCashDiscount = 100;
                        }

                        // Cap the input value at the specific max
                        cashDiscount = Math.min(parseFloat(elements.cashOutInput.value) || 0, maxCashDiscount);
                    } else {
                        buybackDiscount = parseFloat(discountValue);
                    }
                }
                
                const totalDiscounts = buybackDiscount + cashDiscount;
                const finalCostAfterDiscounts = membershipCost - totalDiscounts;
                return { buybackDiscount, cashDiscount, totalDiscounts, finalCostAfterDiscounts };
            }
            
            /**
             * Calculates financing-related costs.
             * @param {number} totalCost
             * @param {number} downpayment
             * @returns {{monthlyPayment: number, financingCost: number, interestSavings: number}}
             */
            function calculateFinancing(totalCost, downpayment) {
                const selectedTerm = parseInt(elements.financingTermSelect.value, 10);
                const monthlyRate = (FINANCING_RATE / 100) / 12;

                const financedAmount = totalCost - downpayment;
                let monthlyPayment = 0;
                if (monthlyRate > 0 && financedAmount > 0) {
                    monthlyPayment = (financedAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -selectedTerm));
                } else if (financedAmount > 0) {
                    monthlyPayment = financedAmount / selectedTerm;
                }
                const financingCost = (monthlyPayment * selectedTerm) - financedAmount;

                // Calculate interest savings for the summary section
                const financedAmountWithoutDownpayment = totalCost;
                let monthlyPaymentWithoutDownpayment = 0;
                if (monthlyRate > 0) {
                    monthlyPaymentWithoutDownpayment = (financedAmountWithoutDownpayment * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -selectedTerm));
                } else {
                    monthlyPaymentWithoutDownpayment = financedAmountWithoutDownpayment / selectedTerm;
                }
                const financingCostWithoutDownpayment = (monthlyPaymentWithoutDownpayment * selectedTerm) - financedAmountWithoutDownpayment;
                const interestSavings = financingCostWithoutDownpayment - (financingCost > 0 ? financingCost : 0);
                
                return {
                    monthlyPayment,
                    financingCost: financingCost > 0 ? financingCost : 0,
                    interestSavings: interestSavings > 0 ? interestSavings : 0
                };
            }

            /**
             * Updates the UI with calculated values.
             * @param {object} values
             */
            function renderResults(values) {
                const formatOptions = { minimumFractionDigits: 2, maximumFractionDigits: 2 };
                const format = (value) => `$${(value || 0).toLocaleString('en-US', formatOptions)}`;

                elements.membershipCostEl.textContent = format(values.membershipCost);
                // Highlight waived annual fee
                if (elements.annualFeeWaivedCheckbox.checked) {
                    elements.annualFeeEl.textContent = 'Waived';
                } else {
                    elements.annualFeeEl.textContent = format(values.annualFee);
                }
                elements.giftValueEl.textContent = format(values.giftValue);
                elements.financingCostEl.textContent = format(values.financingCost);
                elements.downpaymentValueEl.textContent = format(values.downpayment);
                elements.totalCostEl.textContent = format(values.totalCost);
                elements.totalDiscountsEl.textContent = `-${format(values.totalDiscounts)}`;
                elements.packageValueEl.textContent = format(values.packageValue);
                elements.netSavingsEl.textContent = format(values.netSavings);
                elements.monthlyPaymentEl.textContent = format(values.monthlyPayment);
                
                // Special formatting for interest savings
                elements.interestSavingsEl.textContent = format(values.interestSavings);
                if (values.monthlyPayment <= 0) {
                    elements.interestSavingsEl.classList.add('text-green-600', 'font-bold');
                } else {
                    elements.interestSavingsEl.classList.remove('text-green-600', 'font-bold');
                }
                
                // Show/hide and format Cash Discount
                elements.cashOutLine.classList.toggle('hidden', values.cashDiscount === 0);
                elements.cashOutDiscountEl.textContent = `-${format(values.cashDiscount)}`;

                // Update Downpayment color if full payment
                if (values.totalCost > 0 && values.downpayment >= values.totalCost) {
                    elements.downpaymentValueEl.classList.add('text-teal-600');
                } else {
                    elements.downpaymentValueEl.classList.remove('text-teal-600');
                }

                // Update final price display
                elements.finalPriceDisplay.textContent = format(values.totalCost);
            }

            // --- UI Interaction Logic ---

            /**
             * Updates the visual state of the membership cards.
             */
            function updateCardSelection() {
                const cards = [elements.legacyCard, elements.tenCard, elements.threeCard];
                cards.forEach(card => {
                    const id = card.id.replace('-card', '');
                    if (id === selectedMembership) {
                        card.classList.add('selected');
                    } else {
                        card.classList.remove('selected');
                    }
                });

                // Control card visibility based on selected membership
                elements.legacyCard.classList.toggle('hidden', selectedMembership === 'three');
                elements.tenCard.classList.toggle('hidden', selectedMembership === 'three');
                elements.threeCard.classList.toggle('hidden', selectedMembership !== 'three');
                elements.showThreeBtn.classList.toggle('hidden', selectedMembership === 'three');

                // Show/hide upgrade offer button and set text
                elements.upgradeOfferContainer.classList.add('hidden');
                if (selectedMembership === 'ten') {
                    const dailyCost = calculateDailyUpgradeCost('ten', 'legacy');
                    elements.upgradeOfferBtn.textContent = `Upgrade to Legacy Membership for only $${dailyCost}/day`;
                    elements.upgradeOfferContainer.classList.remove('hidden');
                } else if (selectedMembership === 'three') {
                    const dailyCost = calculateDailyUpgradeCost('three', 'ten');
                    elements.upgradeOfferBtn.textContent = `Upgrade to 10-Year Membership for only $${dailyCost}/day`;
                    elements.upgradeOfferContainer.classList.remove('hidden');
                }
                
                if (selectedMembership) {
                    const membershipCost = MEMBERSHIPS[selectedMembership].cost;
                    const defaultDownpayment = membershipCost * DOWNPAYMENT_DEFAULT_PERCENT;
                    elements.downpaymentInput.value = Math.round(defaultDownpayment);
                }

                calculateTotals();
            }

            /**
             * Handles click on the upgrade offer button.
             */
            function handleUpgrade() {
                if (selectedMembership === 'ten') {
                    selectedMembership = 'legacy';
                } else if (selectedMembership === 'three') {
                    selectedMembership = 'ten';
                }
                updateCardSelection();
            }

            /**
             * Handles gift checkbox clicks, ensuring only one is selected for the 3-year plan.
             * @param {Event} event
             */
            function handleGiftSelection(event) {
                // If the selected membership is 'three', enforce single selection
                if (selectedMembership === 'three') {
                    elements.offers.forEach(offer => {
                        if (offer !== event.target) {
                            offer.checked = false;
                        }
                    });
                }
                calculateTotals();
            }

            /**
             * Handles the Payment CTA button click and copies data to clipboard.
             */
            function handlePaymentCTA() {
                const podiumSpeakerName = elements.podiumSpeakerNameInput.value.trim();
                const guestName = elements.guestNameInput.value.trim();

                if (!podiumSpeakerName || !selectedMembership) {
                    elements.vloMessageDiv.textContent = !podiumSpeakerName ? "Please enter the podium speaker's name." : "Please select a membership first.";
                    elements.vloMessageDiv.classList.remove('hidden', 'text-green-600');
                    elements.vloMessageDiv.classList.add('text-red-500');
                    return;
                }
                
                const { buybackDiscount, cashDiscount, finalCostAfterDiscounts } = getDiscounts(MEMBERSHIPS[selectedMembership].cost);
                
                const currentDownpaymentValue = parseFloat(elements.downpaymentInput.value) || 0;
                let downpaymentLine = `Down: $${currentDownpaymentValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                
                // Add "CO" if Cash Out discount was applied
                let cashOutApplied = cashDiscount > 0 && currentDownpaymentValue >= finalCostAfterDiscounts;
                if (cashOutApplied) {
                    downpaymentLine = `Down: CO - $${finalCostAfterDiscounts.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                }

                let buybackLine = '';
                let annualFeeWaivedLine = '';
                // The visibility check has been removed, as the values should persist.
                const selectedDiscountRadio = document.querySelector('.discount-radio:checked');
                if (selectedDiscountRadio && selectedDiscountRadio.value !== 'cash-discount') {
                    buybackLine = `BB: ${selectedDiscountRadio.value}`;
                }
                if (elements.annualFeeWaivedCheckbox.checked) {
                    annualFeeWaivedLine = 'AF: Waived';
                }

                // Construct the clipboard text conditionally
                let clipboardText = `VLO Please
Podium: ${podiumSpeakerName}
Guest: ${guestName || 'N/A'}
${downpaymentLine}`;
                
                if (!cashOutApplied) {
                    clipboardText += `\nTerms: ${elements.financingTermSelect.value} ${elements.monthlyPaymentEl.textContent}`;
                }

                if (buybackLine) {
                    clipboardText += `\n${buybackLine}`;
                }
                if (annualFeeWaivedLine) {
                    clipboardText += `\n${annualFeeWaivedLine}`;
                }

                const textarea = document.createElement('textarea');
                textarea.value = clipboardText;
                textarea.style.position = 'fixed';
                textarea.style.left = '-9999px';
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();

                const success = document.execCommand('copy');
                document.body.removeChild(textarea);

                elements.vloMessageDiv.textContent = success ? "VLO Call Copied to Clipboard" : 'Could not copy details to clipboard. Please copy manually.';
                elements.vloMessageDiv.classList.remove('hidden', success ? 'text-red-500' : 'text-green-600');
                elements.vloMessageDiv.classList.add(success ? 'text-green-600' : 'text-red-500');
            }

            /**
             * Toggles the visibility of the webinar discounts section and updates the icon.
             */
            function toggleOptions() {
                elements.advancedOptionsContent.classList.toggle('hidden');
                elements.eyeOpenIcon.classList.toggle('hidden');
                elements.eyeClosedIcon.classList.toggle('hidden');

                calculateTotals();
            }
            
            /**
             * Manages the enabled/disabled state of the cash discount input based on radio button selection.
             */
            function updateDiscountStates() {
                const selectedRadio = document.querySelector('input[name="discount-option"]:checked');
                if (selectedRadio && selectedRadio.value === 'cash-discount') {
                    elements.cashOutInput.disabled = false;
                } else {
                    elements.cashOutInput.disabled = true;
                    elements.cashOutInput.value = 0;
                }
                calculateTotals();
            }

            // --- Event Listeners and Initialization ---

            function init() {
                // Membership card clicks
                elements.legacyCard.addEventListener('click', () => { selectedMembership = 'legacy'; updateCardSelection(); });
                elements.tenCard.addEventListener('click', () => { selectedMembership = 'ten'; updateCardSelection(); });
                elements.threeCard.addEventListener('click', () => { selectedMembership = 'three'; updateCardSelection(); });
                
                // Button clicks
                elements.showThreeBtn.addEventListener('click', () => { selectedMembership = 'three'; updateCardSelection(); });
                elements.paymentPageBtn.addEventListener('click', handlePaymentCTA);
                elements.upgradeOfferBtn.addEventListener('click', handleUpgrade);
                
                // New event listener for the advanced options header
                elements.advancedOptionsHeader.addEventListener('click', toggleOptions);

                // Option changes
                elements.financingTermSelect.addEventListener('change', updateCardSelection); // Update on term change to recalculate upgrade cost
                elements.downpaymentInput.addEventListener('input', calculateTotals);
                
                // Event listeners for the new mutual exclusivity rule
                elements.discountRadios.forEach(radio => radio.addEventListener('change', updateDiscountStates));
                elements.cashOutInput.addEventListener('input', calculateTotals);

                elements.offers.forEach(offer => offer.addEventListener('change', handleGiftSelection));
                elements.annualFeeWaivedCheckbox.addEventListener('change', calculateTotals);
                
                // Initial calculation on page load
                updateCardSelection();
            }

            init();
        });
    </script>
</body>
</html>
